---
title: "Evolucion del nivel de estudios alcanzado por la poblacion española"
author: "Marco Javier Peñaloza Pérez"
date: "2023-04-25"
subtitle: Serie de tiempo
output: 
  html_document:
    toc: TRUE
    toc_float: TRUE
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
<style>
.justify-text {
  text-align: justify;
  text-justify: inter-word;
}
</style>

<div class="justify-text">

# **Introducción**

La evolución de la educación en España desde la década de 1960 ha sido un proceso significativo en la historia del país. Durante este período, la educación en España ha experimentado una serie de cambios importantes que han transformado radicalmente el sistema educativo y la forma en que se imparte la enseñanza, en el siguiente trabajo se realiza una exploración de una base de datos recogida con los porcentajes de habitantes que han alcanzado un nivel máximo de educación y cómo a través del tiempo se ha visto una mejora importante mejorando los índice de educación.

# **1. Problema de Investigación**

## **1.1. Definición del problema** 

La formación académica de las personas es una variable muy importante en la evolución de la sociedad, al pasar los años las diferentes naciones han implementado mecanismos que buscan que los habitantes de un país mejores sus niveles de educación. Tal es el caso de la población española, de la cual, se tiene una base de datos con los porcentaje de personas que pertenecen a un determinado nivel académico y que se ha visto evolucionado a medida que transcurre el tiempo, por tanto, se hace interesante hacer una exploración y análisis de la serie temporal para sacar conclusiones sobre el progreso y hacer estimaciones a futuro.


## **1.2. Justificación**

La propuesta de análisis de series de tiempo en educación en la población española es importante debido a que permite obtener información valiosa sobre la evolución de los niveles académicos mediante el análisis temporal y hacer pronósticos sobre lo que se puede esperar del fenómeno en si.

## **1.3. Objetivo**

Conocer la evolución temporal de los niveles de educación de España entre los años 1960 a 2020.

# **2. Metodología**

## **2.1 Recopilación de datos** 

Se recolectó información sobre el nivel educativo de la población en España, los cuales han sido tomados de la página: https://www.epdata.es/datos/educacion-espana-mundo-datos-graficos/274

## **2.2 Análisis exploratorio de datos:**

### **2.2.1 Carga de la base de datos**

```{r, echo = TRUE, warning=FALSE, cache=FALSE, message=FALSE}
library(readxl)
data1 <- read_excel("C:/Users/mjpenalozap/Desktop/estudios en españa.xlsx")
head(data, n=6)
```

La base de datos nos da información sobre la fecha en que fueron recogidos los informes sobre los porcentajes de habitantes en españa que pertenecen a los niveles de educación primaria, secundaria y universitario.

### **2.2.2. Resumen estadístico de los datos**

```{r, echo = FALSE, warning=FALSE, cache=FALSE, message=FALSE}
summary(data1)
```

Se puede observar que lo datos han sido recogidos entre los años 1960 y 2019, existen 5 niveles de educación entre los que se encuentran:
Primaria
Primer ciclo de secundaria
Segundo ciclo de secundaria 
Primer ciclo de educación superior
Segundo ciclo de educación superior

En cada nivel se observa un resumen de 5 puntos con los valores mínimo, máximo y los tres cuartiles.

### **2.2.3. Histogramas de las variables**

```{r, echo = FALSE, warning=FALSE, cache=FALSE, message=FALSE}
library(ggplot2)
library(gridExtra)
variables_numericas <- sapply(data1, is.numeric)
graficos <- list()
for (variable in names(data1)[variables_numericas]) {
  grafico <- ggplot(data = data1, aes(x = data1[[variable]])) +
    geom_histogram(fill = "blue", color = "black") +
    labs(x = variable, y = "Frecuencia", title = paste("", variable))
  
  graficos[[variable]] <- grafico
}
gridExtra::grid.arrange(grobs = graficos, ncol = 2)
```

### **2.2.4 Creación del objeto ts**

Se realiza una modificación de la base de datos. Entre los cambios están:

Cambiar la variable temporal al formato de fecha.
Consolidar la variable de interés, que en este análisis se ha seleccionado Primaria.
Construir el objeto ts.


```{r echo=FALSE, warning=FALSE}
data1$fecha <- as.Date(paste0(data1$fecha))

data1 <- aggregate(Primarios ~ fecha, data = data1, sum)

indice.ts <- ts(data1$Primarios, start = c(2018,1), frequency = 12)
indice.ts
```

Ahora se realiza una gráfica del objeto ts:

```{r}
plot(indice.ts, main = "",ylab="valor",col="deepskyblue",xlab="fecha")
title(main = "Evolución de los estudios a nivel de Primaria")
```

**Análisis de la gráfica**

Se puede observar que a medida que han pasado los años el porcentaje de personas que sólo tenían nivel de primaria ha disminuido en España, esto quiere decir que el nivel académico fue mejorando con el tiempo.



```{r echo=FALSE, warning=FALSE}
lag.plot(indice.ts, 9 ,main = "Gráfico de Rezagos",  do.lines = FALSE)
```

Se observa una tendencia ascendente.

### **2.2.5. Media Móvil**

Se procede a crear 3 medias móviles:

```{r}
library(zoo)
mediamovil1 <- rollmean(indice.ts,k=3)
cat("Media Movil con 3 meses: ", mediamovil1,"\n\n")

mediamovil2 <- rollmean(indice.ts,k=4)
cat("Media Movil con 4 meses: ", mediamovil2,"\n\n")

mediamovil3 <- rollmean(indice.ts,k=6)
cat("Media Movil con 6 meses: ", mediamovil3)
```
**Comparación de las medias con los datos originales de la base**


```{r echo=FALSE, warning=FALSE}

plot(1:length(indice.ts), indice.ts, type = "l",   
     ylim = c(min(indice.ts), max(indice.ts)),
     xlab = "Lineas de Serie de Tiempo", ylab = "Valores")
lines(1:length(mediamovil1),mediamovil1,type = "l", col=2)
lines(1:length(mediamovil2),mediamovil2,type = "l", col=3)
lines(1:length(mediamovil3),mediamovil3,type = "l", col=4)
legend("topleft",
       c("Indice.Ts", "Media Movil 3 Meses", "Media Movil 4 Meses", "Media Movil 6 Meses"),
       lty = 1, col = 1:4)
```

# **3 Estacionalidad y Descomposición:** 

## **3.1 Estacionalidad**

```{r}
library(ggseas)
library(forecast)
ggseasonplot(x = indice.ts,
             main= "Análisis por Fecha")
```

Se observa que en todos los años hay una disminución de los porcentajes en cada nivel académico de primaria.

## **3.2. Descomposición del objeto y análisis**

```{r echo=FALSE, warning=FALSE}

descomposicion <- decompose(x=indice.ts)
plot(descomposicion, xlab="Tiempo")
```

## **3.3 Prueba de Estacionalidad**

```{r echo=FALSE, warning=FALSE}
library(tseries)
adf.test(indice.ts)
```
Se concluye que con un nivel de significancia del 5% existe evidencia estadística para aceptar la hipótesis nula de que no hay estacionalidad en el conjunto de datos.


## **3.4. Autocorrelación**


```{r echo=FALSE, warning=FALSE}
tsdisplay(indice.ts,lag.max = 20)
```


## **3.5 Transformación**

Se ajusta la estacionalidad de la serie temporal.
```{r}
indice_adj <- seasadj(descomposicion)
```

Se remueve la tedencia (trend) para el modelo.

```{r}
modelo_ts <- diff(indice_adj)
```

Se grafica la nueva descomposición.

```{r echo=FALSE, warning=FALSE}

nueva_descomp <-decompose(modelo_ts)
plot(nueva_descomp)
```

## **3.6 Validación de la nueva serie de tiempo transformada**

**Test de estacionalidad**

```{r echo=FALSE, warning=FALSE}
adf.test(modelo_ts)
```

**Test de autocorrelación**

```{r echo=FALSE, warning=FALSE}
tsdisplay(modelo_ts,lag.max = 20)
```

# **4. Holt-Winters(HW) y Suavizamiento Exponencial**

## **4.1 Holt-Winters(HW)**

Holt-Winters es un método ampliamente utilizado en el análisis de series de tiempo para realizar pronósticos a corto plazo. Esto permite predecir cambios en la tendencia a lo largo del tiempo, lo cual es especialmente útil cuando se trabaja con datos que presentan una tendencia ascendente o descendente.

```{r message=FALSE, warning=FALSE}

hw_model <- HoltWinters(indice.ts)

# Componentes del modelo (tendencia, estacionalidad y residuos)
trend <- hw_model$components$trend
seasonal <- hw_model$components$seasonal
residuals <- hw_model$components$random

# Imprimir las componentes
print("Tendencia:")
print(trend)
print("Estacionalidad:")
print(seasonal)
print("Residuos:")
print(residuals)

```

## **4.2 Suavizamiento Exponencial**

Holt-Winters utiliza técnicas de suavizado exponencial para predecir los valores futuros de una serie de tiempo. Esto implica asignar pesos exponenciales a los puntos de datos históricos, lo que da mayor importancia a los datos más recientes. Esta característica es útil para adaptarse a los cambios en los patrones de la serie de tiempo a medida que los datos más recientes tienen un impacto más significativo en las predicciones.

A continuación, se aplica el suavizamiento exponencial

```{r message=FALSE, warning=FALSE}
 
smoothed <- HoltWinters(indice.ts, beta = FALSE, gamma = FALSE)$fitted

print("Serie de tiempo suavizada:")
print(smoothed)

```


El suavizamiento exponencial a la serie de tiempo del indice.ts, permite obtener la tendencia, la estacionalidad, los residuos y la serie de tiempo suavizada. Lo cual permite comprender la estructura y los patrones de la serie de tiempo.


```{r message=FALSE, warning=FALSE}
hw_model=HoltWinters(indice.ts, seasonal = "additive")
plot(hw_model)
```

Se genera un gráfico en color rojo que representa una serie de datos aproximada a los datos originales en color negro. 

```{r message=FALSE, warning=FALSE}

plot(fitted(hw_model))
```

En el gráfico se observa la descomposición en las cuatro componentes. El método Holt Winters nos permite realizar predicciones utilizando la serie de tiempo. A continuación, se muestra el proceso de generación de predicciones.

```{r message=FALSE, warning=FALSE}
pred=predict(hw_model, 12, prediction.interval = TRUE)
pred
```

Ejemplo de predicciones en los  12 meses siguientes (May 2023 - Apr 2024).


```{r message=FALSE, warning=FALSE}
plot(hw_model, pred)
```

Podemos observar la tendencia del pronóstico con sus respectivos intervalos de confianza.

Se puede calcular el modelo Holt-Winters con la funcion **hw** para el mismo fin:

```{r message=FALSE, warning=FALSE}
hw_model1 <- HoltWinters(indice.ts)
hw_model1
```

Predicciones para los próximos 12 periodos.

```{r message=FALSE, warning=FALSE}
library(forecast) 
predictions <- forecast(hw_model1, h = 12)  
```


```{r message=FALSE, warning=FALSE}

plot(hw_model1, main = "Modelo de Holt-Winters: Serie de tiempo y Predicciones")
lines(predictions$mean, col = "blue")
legend("bottomright", legend = c("Serie de tiempo", "Predicciones"), col = c("black", "blue"), lty = 1)
```

# **5. Referencias Bibliográficas**

1. EpData. (2019). Evolución del nivel de estudios alcanzado por la población española [Data set]. EpData - La actualidad informativa en datos estadísticos de Europa Press.